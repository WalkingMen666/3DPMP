-- ============================================================================
-- 3DPMP Sample Data Population
-- 3D Printing and Model-sharing Platform
-- ============================================================================
-- This file contains SQL statements for populating the database with sample data.
-- Execute AFTER schema.sql
-- ============================================================================

-- ============================================================================
-- 1. USERS (Admin, Employees, Customers)
-- ============================================================================

-- Note: Passwords are hashed using Django's PBKDF2 algorithm
-- Default password for all users: "testpass123"
-- Hash: pbkdf2_sha256$720000$... (generated by Django)

-- Admin User
INSERT INTO users_user (id, password, email, is_superuser, is_staff, is_active, first_name, last_name, auth_provider, date_joined)
VALUES 
    ('a0000000-0000-0000-0000-000000000001', 
     'pbkdf2_sha256$720000$salt$hashedpassword', -- Replace with actual hash in production
     'admin@3dpmp.com', TRUE, TRUE, TRUE, 'System', 'Admin', 'local', CURRENT_TIMESTAMP);

-- Employee Users
INSERT INTO users_user (id, password, email, is_superuser, is_staff, is_active, first_name, last_name, auth_provider, date_joined)
VALUES 
    ('e0000000-0000-0000-0000-000000000001', 
     'pbkdf2_sha256$720000$salt$hashedpassword',
     'employee1@3dpmp.com', FALSE, TRUE, TRUE, 'Alice', 'Wang', 'local', CURRENT_TIMESTAMP),
    ('e0000000-0000-0000-0000-000000000002', 
     'pbkdf2_sha256$720000$salt$hashedpassword',
     'employee2@3dpmp.com', FALSE, TRUE, TRUE, 'Bob', 'Chen', 'local', CURRENT_TIMESTAMP);

-- Customer Users
INSERT INTO users_user (id, password, email, is_superuser, is_staff, is_active, first_name, last_name, auth_provider, date_joined)
VALUES 
    ('c0000000-0000-0000-0000-000000000001', 
     'pbkdf2_sha256$720000$salt$hashedpassword',
     'customer1@example.com', FALSE, FALSE, TRUE, 'David', 'Lin', 'local', CURRENT_TIMESTAMP),
    ('c0000000-0000-0000-0000-000000000002', 
     'pbkdf2_sha256$720000$salt$hashedpassword',
     'customer2@example.com', FALSE, FALSE, TRUE, 'Emily', 'Liu', 'google', CURRENT_TIMESTAMP),
    ('c0000000-0000-0000-0000-000000000003', 
     'pbkdf2_sha256$720000$salt$hashedpassword',
     'customer3@example.com', FALSE, FALSE, TRUE, 'Frank', 'Wu', 'local', CURRENT_TIMESTAMP);

-- Employee Profiles (user_id is PK)
INSERT INTO users_employee (user_id, employee_name, is_admin)
VALUES 
    ('a0000000-0000-0000-0000-000000000001', 'System Administrator', TRUE),
    ('e0000000-0000-0000-0000-000000000001', 'Alice Wang', FALSE),
    ('e0000000-0000-0000-0000-000000000002', 'Bob Chen', FALSE);

-- Customer Profiles (user_id is PK)
INSERT INTO users_customer (user_id)
VALUES 
    ('c0000000-0000-0000-0000-000000000001'),
    ('c0000000-0000-0000-0000-000000000002'),
    ('c0000000-0000-0000-0000-000000000003');

-- ============================================================================
-- 2. MATERIALS
-- ============================================================================

INSERT INTO material (id, name, density_g_cm3, price_twd_g, is_active)
VALUES 
    ('m0000000-0000-0000-0000-000000000001', 'PLA Basic - White', 1.24000, 0.80, TRUE),
    ('m0000000-0000-0000-0000-000000000002', 'PLA Basic - Black', 1.24000, 0.80, TRUE),
    ('m0000000-0000-0000-0000-000000000003', 'PLA Basic - Red', 1.24000, 0.85, TRUE),
    ('m0000000-0000-0000-0000-000000000004', 'PLA Basic - Blue', 1.24000, 0.85, TRUE),
    ('m0000000-0000-0000-0000-000000000005', 'PLA Silk - Gold', 1.24000, 1.20, TRUE),
    ('m0000000-0000-0000-0000-000000000006', 'PLA Silk - Silver', 1.24000, 1.20, TRUE),
    ('m0000000-0000-0000-0000-000000000007', 'PETG - Transparent', 1.27000, 1.00, TRUE),
    ('m0000000-0000-0000-0000-000000000008', 'PETG - Black', 1.27000, 1.00, TRUE),
    ('m0000000-0000-0000-0000-000000000009', 'ABS - White', 1.04000, 0.90, TRUE),
    ('m0000000-0000-0000-0000-000000000010', 'ABS - Black', 1.04000, 0.90, TRUE),
    ('m0000000-0000-0000-0000-000000000011', 'TPU Flexible - Black', 1.21000, 1.50, TRUE),
    ('m0000000-0000-0000-0000-000000000012', 'PLA Wood Composite', 1.15000, 1.80, TRUE);

-- ============================================================================
-- 3. SHIPPING OPTIONS
-- ============================================================================

INSERT INTO shipping_option (id, name, type, base_fee, is_active)
VALUES 
    ('s0000000-0000-0000-0000-000000000001', '黑貓宅急便', 'HOME_DELIVERY', 100.00, TRUE),
    ('s0000000-0000-0000-0000-000000000002', '新竹物流', 'HOME_DELIVERY', 90.00, TRUE),
    ('s0000000-0000-0000-0000-000000000003', '7-11 店到店', 'CONVENIENCE_STORE', 60.00, TRUE),
    ('s0000000-0000-0000-0000-000000000004', '全家 店到店', 'CONVENIENCE_STORE', 60.00, TRUE),
    ('s0000000-0000-0000-0000-000000000005', '萊爾富 店到店', 'CONVENIENCE_STORE', 55.00, TRUE),
    ('s0000000-0000-0000-0000-000000000006', '門市自取', 'SELF_PICKUP', 0.00, TRUE);

-- ============================================================================
-- 4. CUSTOMER SAVED ADDRESSES
-- ============================================================================

-- Get customer IDs (now using UUID directly from user_id)
-- Customer 1 addresses
INSERT INTO saved_address (id, customer_id, name, address_type, address_details, is_default)
VALUES 
    ('ad000000-0000-0000-0000-000000000001', 'c0000000-0000-0000-0000-000000000001', '我的住家', 'HOME_DELIVERY', 
     '{"recipient": "林大衛", "phone": "0912-345-678", "address": "台北市信義區信義路五段7號", "notes": "請按門鈴"}', TRUE),
    ('ad000000-0000-0000-0000-000000000002', 'c0000000-0000-0000-0000-000000000001', '公司', 'HOME_DELIVERY', 
     '{"recipient": "林大衛", "phone": "0912-345-678", "address": "台北市內湖區瑞光路358號", "notes": "請送到1樓櫃台"}', FALSE),
    ('ad000000-0000-0000-0000-000000000003', 'c0000000-0000-0000-0000-000000000001', '家附近的7-11', 'CONVENIENCE_STORE', 
     '{"store_id": "123456", "store_name": "信義門市", "recipient": "林大衛", "phone": "0912-345-678"}', FALSE);

-- Customer 2 addresses
INSERT INTO saved_address (id, customer_id, name, address_type, address_details, is_default)
VALUES 
    ('ad000000-0000-0000-0000-000000000004', 'c0000000-0000-0000-0000-000000000002', '住家', 'HOME_DELIVERY', 
     '{"recipient": "劉艾蜜莉", "phone": "0923-456-789", "address": "新北市板橋區文化路一段100號", "notes": ""}', TRUE);

-- Customer 3 addresses
INSERT INTO saved_address (id, customer_id, name, address_type, address_details, is_default)
VALUES 
    ('ad000000-0000-0000-0000-000000000005', 'c0000000-0000-0000-0000-000000000003', '自取', 'SELF_PICKUP', 
     '{"recipient": "吳法蘭克", "phone": "0934-567-890", "pickup_location": "台北門市"}', TRUE);

-- ============================================================================
-- 5. 3D MODELS
-- ============================================================================

INSERT INTO model (id, owner_id, model_name, visibility_status, stl_file_path, gcode_file_path, slicing_info)
VALUES 
    -- Customer 1's models
    ('md000000-0000-0000-0000-000000000001', 'c0000000-0000-0000-0000-000000000001', 
     'Pikachu Figure', 'PUBLIC', 
     'users/c0000000/models/pikachu.stl', 
     'users/c0000000/gcode/pikachu.gcode',
     '{"weight_g": 45.2, "print_time_min": 180, "layer_height": 0.2, "infill": 20}'),
    
    ('md000000-0000-0000-0000-000000000002', 'c0000000-0000-0000-0000-000000000001', 
     'Phone Stand', 'PUBLIC', 
     'users/c0000000/models/phone_stand.stl', 
     'users/c0000000/gcode/phone_stand.gcode',
     '{"weight_g": 28.5, "print_time_min": 95, "layer_height": 0.2, "infill": 15}'),
    
    ('md000000-0000-0000-0000-000000000003', 'c0000000-0000-0000-0000-000000000001', 
     'Custom Keychain', 'PRIVATE', 
     'users/c0000000/models/keychain.stl', 
     NULL,
     NULL), -- Not yet sliced

    -- Customer 2's models
    ('md000000-0000-0000-0000-000000000004', 'c0000000-0000-0000-0000-000000000002', 
     'Desk Organizer', 'PUBLIC', 
     'users/c0000000/models/desk_organizer.stl', 
     'users/c0000000/gcode/desk_organizer.gcode',
     '{"weight_g": 120.8, "print_time_min": 420, "layer_height": 0.2, "infill": 20}'),
    
    ('md000000-0000-0000-0000-000000000005', 'c0000000-0000-0000-0000-000000000002', 
     'Geometric Vase', 'PENDING', 
     'users/c0000000/models/vase.stl', 
     'users/c0000000/gcode/vase.gcode',
     '{"weight_g": 85.3, "print_time_min": 280, "layer_height": 0.15, "infill": 10}'),

    -- Customer 3's models
    ('md000000-0000-0000-0000-000000000006', 'c0000000-0000-0000-0000-000000000003', 
     'Dragon Sculpture', 'REJECTED', 
     'users/c0000000/models/dragon.stl', 
     'users/c0000000/gcode/dragon.gcode',
     '{"weight_g": 250.0, "print_time_min": 720, "layer_height": 0.1, "infill": 25}'),
    
    ('md000000-0000-0000-0000-000000000007', 'c0000000-0000-0000-0000-000000000003', 
     'Chess Set', 'PUBLIC', 
     'users/c0000000/models/chess.stl', 
     'users/c0000000/gcode/chess.gcode',
     '{"weight_g": 180.5, "print_time_min": 540, "layer_height": 0.15, "infill": 30}');

-- ============================================================================
-- 6. MODEL IMAGES
-- ============================================================================

INSERT INTO model_image (id, model_id, image_path)
VALUES 
    ('mi000000-0000-0000-0000-000000000001', 'md000000-0000-0000-0000-000000000001', 'users/c0000000/images/pikachu_front.jpg'),
    ('mi000000-0000-0000-0000-000000000002', 'md000000-0000-0000-0000-000000000001', 'users/c0000000/images/pikachu_side.jpg'),
    ('mi000000-0000-0000-0000-000000000003', 'md000000-0000-0000-0000-000000000002', 'users/c0000000/images/phone_stand.jpg'),
    ('mi000000-0000-0000-0000-000000000004', 'md000000-0000-0000-0000-000000000004', 'users/c0000000/images/desk_organizer.jpg'),
    ('mi000000-0000-0000-0000-000000000005', 'md000000-0000-0000-0000-000000000007', 'users/c0000000/images/chess_set.jpg');

-- ============================================================================
-- 7. MODEL REVIEW LOGS
-- ============================================================================

-- Employee (Alice) reviewed models
INSERT INTO model_review_log (id, model_id, reviewer_id, previous_status, new_status, reason)
VALUES 
    ('rl000000-0000-0000-0000-000000000001', 'md000000-0000-0000-0000-000000000001', 
     'e0000000-0000-0000-0000-000000000001', 'PENDING', 'PUBLIC', '模型品質良好，符合公開標準'),
    ('rl000000-0000-0000-0000-000000000002', 'md000000-0000-0000-0000-000000000002', 
     'e0000000-0000-0000-0000-000000000001', 'PENDING', 'PUBLIC', '實用設計，已審核通過'),
    ('rl000000-0000-0000-0000-000000000003', 'md000000-0000-0000-0000-000000000004', 
     'e0000000-0000-0000-0000-000000000001', 'PENDING', 'PUBLIC', '審核通過');

-- Employee (Bob) reviewed models
INSERT INTO model_review_log (id, model_id, reviewer_id, previous_status, new_status, reason)
VALUES 
    ('rl000000-0000-0000-0000-000000000004', 'md000000-0000-0000-0000-000000000006', 
     'e0000000-0000-0000-0000-000000000002', 'PENDING', 'REJECTED', '模型包含版權問題，請修改後重新提交'),
    ('rl000000-0000-0000-0000-000000000005', 'md000000-0000-0000-0000-000000000007', 
     'e0000000-0000-0000-0000-000000000002', 'PENDING', 'PUBLIC', '審核通過，經典設計');

-- ============================================================================
-- 8. DISCOUNTS
-- ============================================================================

-- Global Discounts (auto-applied)
INSERT INTO discount (id, name, description, start_date, due_date, min_price, max_discount, works_on, is_fixed, dis_value, is_active)
VALUES 
    ('d0000000-0000-0000-0000-000000000001', 
     '新會員首購優惠', '新會員首次購買享9折優惠', 
     '2024-01-01 00:00:00+08', '2025-12-31 23:59:59+08', 
     0.00, 500.00, 'ORDER_SUBTOTAL', FALSE, 10.00, TRUE),
    ('d0000000-0000-0000-0000-000000000002', 
     '滿千免運', '訂單滿 NT$1000 免運費', 
     '2024-01-01 00:00:00+08', NULL, 
     1000.00, NULL, 'SHIPPING', FALSE, 100.00, TRUE),
    ('d0000000-0000-0000-0000-000000000003', 
     '夏季促銷', '夏季限定全站 85 折', 
     '2024-06-01 00:00:00+08', '2024-08-31 23:59:59+08', 
     500.00, 1000.00, 'ORDER_SUBTOTAL', FALSE, 15.00, FALSE); -- Inactive (past promotion)

INSERT INTO global_discount (discount_id, priority)
VALUES 
    ('d0000000-0000-0000-0000-000000000001', 10),
    ('d0000000-0000-0000-0000-000000000002', 5),
    ('d0000000-0000-0000-0000-000000000003', 1);

-- Coupons (user-entered)
INSERT INTO discount (id, name, description, start_date, due_date, min_price, max_discount, works_on, is_fixed, dis_value, is_active)
VALUES 
    ('d0000000-0000-0000-0000-000000000004', 
     '歡迎優惠券', '新用戶專屬 NT$100 折抵', 
     '2024-01-01 00:00:00+08', '2025-12-31 23:59:59+08', 
     300.00, NULL, 'ORDER_SUBTOTAL', TRUE, 100.00, TRUE),
    ('d0000000-0000-0000-0000-000000000005', 
     'VIP 專屬優惠', 'VIP 會員 8 折優惠碼', 
     '2024-01-01 00:00:00+08', '2025-12-31 23:59:59+08', 
     500.00, 2000.00, 'TOTAL', FALSE, 20.00, TRUE),
    ('d0000000-0000-0000-0000-000000000006', 
     '免運券', '單次免運費優惠券', 
     '2024-01-01 00:00:00+08', '2025-06-30 23:59:59+08', 
     0.00, NULL, 'SHIPPING', FALSE, 100.00, TRUE);

INSERT INTO coupon (discount_id, coupon_code, max_uses_total, max_uses_per_customer)
VALUES 
    ('d0000000-0000-0000-0000-000000000004', 'WELCOME2024', 1000, 1),
    ('d0000000-0000-0000-0000-000000000005', 'VIP20OFF', NULL, 3),
    ('d0000000-0000-0000-0000-000000000006', 'FREESHIP', 500, 1);

-- ============================================================================
-- 9. SAMPLE ORDERS
-- ============================================================================

-- Order 1: Completed order for Customer 1
INSERT INTO "order" (id, customer_id, assignee_id, status, ship_snapshot, total_price, notes, tracking_number)
VALUES 
    ('o0000000-0000-0000-0000-000000000001', 'c0000000-0000-0000-0000-000000000001', 'e0000000-0000-0000-0000-000000000001', 'COMPLETED',
     '{"service_name": "黑貓宅急便", "fee": 100.00, "address": {"recipient": "林大衛", "phone": "0912-345-678", "address": "台北市信義區信義路五段7號"}}',
     536.16, '請小心包裝', '12345678901234');

INSERT INTO order_item (id, order_id, model_id, material_id, item_number, quantity, price_snapshot, slicing_info_snapshot)
VALUES 
    ('oi000000-0000-0000-0000-000000000001', 'o0000000-0000-0000-0000-000000000001', 
     'md000000-0000-0000-0000-000000000001', 'm0000000-0000-0000-0000-000000000001',
     1, 2, 36.16, '{"weight_g": 45.2, "print_time_min": 180}'),
    ('oi000000-0000-0000-0000-000000000002', 'o0000000-0000-0000-0000-000000000001', 
     'md000000-0000-0000-0000-000000000002', 'm0000000-0000-0000-0000-000000000005',
     2, 1, 34.20, '{"weight_g": 28.5, "print_time_min": 95}');

-- Order 2: Processing order for Customer 2
INSERT INTO "order" (id, customer_id, assignee_id, status, ship_snapshot, total_price, notes)
VALUES 
    ('o0000000-0000-0000-0000-000000000002', 'c0000000-0000-0000-0000-000000000002', 'e0000000-0000-0000-0000-000000000002', 'PRINTING',
     '{"service_name": "7-11 店到店", "fee": 60.00, "store": {"store_id": "789012", "store_name": "板橋文化門市"}}',
     180.64, NULL);

INSERT INTO order_item (id, order_id, model_id, material_id, item_number, quantity, price_snapshot, slicing_info_snapshot)
VALUES 
    ('oi000000-0000-0000-0000-000000000003', 'o0000000-0000-0000-0000-000000000002', 
     'md000000-0000-0000-0000-000000000004', 'm0000000-0000-0000-0000-000000000008',
     1, 1, 120.80, '{"weight_g": 120.8, "print_time_min": 420}');

-- Order 3: Pending order for Customer 3
INSERT INTO "order" (id, customer_id, assignee_id, status, ship_snapshot, total_price, notes)
VALUES 
    ('o0000000-0000-0000-0000-000000000003', 'c0000000-0000-0000-0000-000000000003', NULL, 'PENDING',
     '{"service_name": "門市自取", "fee": 0.00, "pickup_location": "台北門市"}',
     324.90, '西洋棋套組，黑白各一組');

INSERT INTO order_item (id, order_id, model_id, material_id, item_number, quantity, price_snapshot, slicing_info_snapshot)
VALUES 
    ('oi000000-0000-0000-0000-000000000004', 'o0000000-0000-0000-0000-000000000003', 
     'md000000-0000-0000-0000-000000000007', 'm0000000-0000-0000-0000-000000000001',
     1, 1, 144.40, '{"weight_g": 180.5, "print_time_min": 540}'),
    ('oi000000-0000-0000-0000-000000000005', 'o0000000-0000-0000-0000-000000000003', 
     'md000000-0000-0000-0000-000000000007', 'm0000000-0000-0000-0000-000000000002',
     2, 1, 144.40, '{"weight_g": 180.5, "print_time_min": 540}');

-- ============================================================================
-- 10. ORDER LOGS
-- ============================================================================

INSERT INTO order_log (id, order_id, updated_by_id, previous_status, new_status, notes)
VALUES 
    -- Order 1 history
    ('ol000000-0000-0000-0000-000000000001', 'o0000000-0000-0000-0000-000000000001', 
     'e0000000-0000-0000-0000-000000000001', 'PENDING', 'CONFIRMED', '訂單已確認'),
    ('ol000000-0000-0000-0000-000000000002', 'o0000000-0000-0000-0000-000000000001', 
     'e0000000-0000-0000-0000-000000000001', 'CONFIRMED', 'PROCESSING', '開始處理'),
    ('ol000000-0000-0000-0000-000000000003', 'o0000000-0000-0000-0000-000000000001', 
     'e0000000-0000-0000-0000-000000000001', 'PROCESSING', 'PRINTING', '列印中'),
    ('ol000000-0000-0000-0000-000000000004', 'o0000000-0000-0000-0000-000000000001', 
     'e0000000-0000-0000-0000-000000000001', 'PRINTING', 'QUALITY_CHECK', '品質檢查中'),
    ('ol000000-0000-0000-0000-000000000005', 'o0000000-0000-0000-0000-000000000001', 
     'e0000000-0000-0000-0000-000000000001', 'QUALITY_CHECK', 'SHIPPED', '已出貨'),
    ('ol000000-0000-0000-0000-000000000006', 'o0000000-0000-0000-0000-000000000001', 
     'e0000000-0000-0000-0000-000000000001', 'SHIPPED', 'COMPLETED', '已完成'),
    
    -- Order 2 history
    ('ol000000-0000-0000-0000-000000000007', 'o0000000-0000-0000-0000-000000000002', 
     'e0000000-0000-0000-0000-000000000002', 'PENDING', 'CONFIRMED', '訂單已確認'),
    ('ol000000-0000-0000-0000-000000000008', 'o0000000-0000-0000-0000-000000000002', 
     'e0000000-0000-0000-0000-000000000002', 'CONFIRMED', 'PROCESSING', '準備列印'),
    ('ol000000-0000-0000-0000-000000000009', 'o0000000-0000-0000-0000-000000000002', 
     'e0000000-0000-0000-0000-000000000002', 'PROCESSING', 'PRINTING', '列印進行中');

-- ============================================================================
-- 11. APPLIED DISCOUNTS
-- ============================================================================

-- Order 1 used "滿千免運" (but didn't qualify, so no record needed)
-- Order 2 used "新會員首購優惠"
INSERT INTO is_affected (id, order_id, global_discount_id, discount_snapshot_info, discount_amount)
VALUES 
    ('ia000000-0000-0000-0000-000000000001', 'o0000000-0000-0000-0000-000000000002', 
     'd0000000-0000-0000-0000-000000000001',
     '{"name": "新會員首購優惠", "type": "percentage", "value": 10, "max_discount": 500}',
     12.08);

-- Order 1 used a coupon
INSERT INTO coupon_redemption (id, customer_id, coupon_id, order_id, discount_snapshot_info, discount_amount)
VALUES 
    ('cr000000-0000-0000-0000-000000000001', 'c0000000-0000-0000-0000-000000000001', 'd0000000-0000-0000-0000-000000000004', 
     'o0000000-0000-0000-0000-000000000001',
     '{"code": "WELCOME2024", "type": "fixed", "value": 100}',
     100.00);

-- ============================================================================
-- 12. CART ITEMS (Active shopping carts)
-- ============================================================================

-- Customer 1 has items in cart
INSERT INTO cart_item (id, customer_id, model_id, material_id, quantity, notes)
VALUES 
    ('ci000000-0000-0000-0000-000000000001', 'c0000000-0000-0000-0000-000000000001', 
     'md000000-0000-0000-0000-000000000004', 'm0000000-0000-0000-0000-000000000007',
     1, '想要透明材質'),
    ('ci000000-0000-0000-0000-000000000002', 'c0000000-0000-0000-0000-000000000001', 
     'md000000-0000-0000-0000-000000000007', 'm0000000-0000-0000-0000-000000000003',
     2, '紅色西洋棋');

-- Customer 3 has items in cart
INSERT INTO cart_item (id, customer_id, model_id, material_id, quantity, notes)
VALUES 
    ('ci000000-0000-0000-0000-000000000003', 'c0000000-0000-0000-0000-000000000003', 
     'md000000-0000-0000-0000-000000000002', 'm0000000-0000-0000-0000-000000000011',
     1, 'TPU 軟質手機架');
